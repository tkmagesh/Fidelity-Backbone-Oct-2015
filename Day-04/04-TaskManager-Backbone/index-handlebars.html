<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Manager</title>
    <style>
        .completed{
            color : red;
            font-style: italic;
            text-decoration: line-through;
            font-weight: bold;
        }
    </style>
    <script src="jquery-2.1.4.js"></script>
    <script src="underscore.js"></script>
    <script src="backbone.js"></script>
    <script src="handlebars-v4.0.2.js"></script>
    <script type="text/template" id="taskTemplate">
        {{#if isEdit}}
            <input type='text' id='txtTaskName' value='{{name}}'>
            <input type='button' value='Save' id='btnEditSave'>
        {{else}}
            {{#if isCompleted}}
                <span class='spanTaskName completed'>{{name}}</span>
            {{else}}
                <span class='spanTaskName'>{{name}}</span>
            {{/if}}
            <input type='button' value='Edit' id='btnEditSave'>
        {{/if}}
    </script>
    <script>
    var Task = Backbone.Model.extend({
        defaults : {
            name : '',
            isCompleted : false,
            isEdit : false
        },
        toggle : function(){
            this.set("isCompleted", !this.get("isCompleted"));
        },
        toggleEdit : function(){
            this.set("isEdit", !this.get("isEdit"));
        }
    });
    var TaskView = Backbone.View.extend({
        templateId : "#taskTemplate",
        model : Task,
        tagName : "li",
        events :{
            "click .spanTaskName" : "toggleTask",
            "click #btnEditSave" : "editSaveTask"
        },
        editSaveTask : function(){
            if (this.model.get("isEdit")){
                this.model.set("name", this.$("#txtTaskName").val());
            }
            this.model.toggleEdit();
        },
        toggleTask : function(){
            this.model.toggle();
        },
        initialize : function(){
            _.bindAll(this, "render");
            this.model.on("change", this.render);
        },
        render : function(){
            console.log(this.model.toJSON());
            if (!this.templateFn){
                this.templateFn = Handlebars.compile($(this.templateId).html());
            }
            this.$el.html(this.templateFn(this.model.toJSON()));
            return this;
        }
    });
    var t1 = new Task({name : "Explore Delhi"});
    var tv1 = new TaskView({model : t1});

    var t2 = new Task({name : "Master jQuery", isCompleted : true});
    var tv2 = new TaskView({model : t2});

    $(function(){
        tv1.render().$el.appendTo(document.body);
        tv2.render().$el.appendTo(document.body);
    })
    </script>
</head>
<body>

</body>
</html>
